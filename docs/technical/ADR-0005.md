# ADR-0005: Otimizacao de SVGs com SVGO e Descoberta de Raster Embedado

## Vinculado a
TASK-0011 (Quick Win MPF-005)

## Status
Accepted

## Contexto

Os arquivos SVG dos profissionais em `/public/imagens/profissionais/` estavam consumindo aproximadamente 6 MB de espaco total:
- `anabia.svg`: 395 KB
- `ana-laura.svg`: 217 KB
- `denis-graciotto.svg`: 5.3 MB (92% do total)

Este tamanho excessivo afeta negativamente:
- Tempo de carregamento inicial da pagina
- Consumo de largura de banda dos usuarios
- Performance em conexoes lentas ou dispositivos moveis

O objetivo da TASK-0011 era comprimir estes SVGs usando SVGO para reducao significativa de tamanho.

## Decisao

**Acao tomada:**
1. Instalado SVGO 4.0.0 como devDependency
2. Executado `npx svgo` em todos os 3 arquivos SVG
3. Adicionado script `"optimize-svg"` no `package.json` para otimizacoes futuras
4. Criado backup dos SVGs originais em `/.svg-backups/` (nao versionado)

**Resultados da otimizacao:**
- `ana-laura.svg`: 216.54 KB → 197.19 KB (reducao de 8.9%)
- `anabia.svg`: 394.20 KB → 374.86 KB (reducao de 4.9%)
- `denis-graciotto.svg`: 5421.06 KB → 5401.57 KB (reducao de 0.4%)

**Total:** 6031.8 KB → 5973.6 KB (reducao de ~58 KB ou 1%)

## Descoberta Critica: SVG com JPEG Embedado

Durante a analise do arquivo `denis-graciotto.svg`, descobrimos que ele nao e um SVG vetorial puro, mas sim um wrapper SVG contendo uma **imagem JPEG embedada em base64**.

**Evidencias:**
```bash
$ grep "data:image" denis-graciotto.svg | head -c 200
data:image/jpeg;base64

$ wc -l denis-graciotto.svg
0  # Todo o conteudo esta em uma unica linha
```

**Implicacoes:**
- SVGO nao pode otimizar dados rasterizados (JPEG/PNG) embedados
- O arquivo continuara grande (~5.3 MB) mesmo apos otimizacao SVG
- A abordagem ideal seria extrair o JPEG, otimiza-lo separadamente e/ou converter para formatos modernos (WebP/AVIF)

## Consequencias

### Positivas
- SVGs vetoriais verdadeiros (`ana-laura.svg`, `anabia.svg`) foram otimizados em ~5-9%
- Pipeline de otimizacao SVG estabelecido com SVGO instalado e script `optimize-svg` disponivel
- Descoberta documentada sobre o SVG com raster embedado permite planejamento de otimizacao futura
- Build e lint continuam passando
- Imagens renderizam identicamente apos otimizacao

### Negativas
- Reducao total de tamanho foi apenas ~1% (58 KB de 6 MB) devido ao JPEG embedado
- `denis-graciotto.svg` continua sendo um bottleneck de performance (5.3 MB)
- Otimizacao completa requer trabalho adicional fora do escopo desta TASK

## Recomendacao para Otimizacao Futura

O arquivo `denis-graciotto.svg` deveria ser tratado em uma TASK futura dedicada:

1. **Opcao A - Converter para formato moderno:**
   - Extrair o JPEG embedado
   - Converter para WebP (reducao esperada: ~80%)
   - Ou converter para AVIF (reducao esperada: ~90%)
   - Manter SVG apenas como fallback

2. **Opcao B - Otimizar o raster:**
   - Extrair o JPEG
   - Redimensionar para dimensoes reais de uso (se maior que necessario)
   - Comprimir com qualidade otimizada (ex: 85% quality)
   - Re-embedar ou servir separadamente

3. **Opcao C - Usar Picture element com srcset:**
   - Criar versoes otimizadas em multiplos formatos
   - Usar `<picture>` com fallbacks para compatibilidade
   - Permitir browser escolher melhor formato

**Reducao estimada:** De 5.3 MB para ~500 KB - 1 MB (reducao de 80-90%)

## Alternativas Consideradas

### Alternativa 1: Configuracao SVGO Mais Agressiva
- **Descricao:** Aumentar agressividade da otimizacao SVGO (menor precisao de floats, remover mais atributos)
- **Motivo da rejeicao:** Nao teria impacto significativo em raster embedado; risco de corrupcao visual em SVGs vetoriais

### Alternativa 2: Converter Todos SVGs para Raster Otimizado
- **Descricao:** Converter todos os 3 SVGs para WebP/AVIF
- **Motivo da rejeicao:** `anabia.svg` e `ana-laura.svg` sao SVGs vetoriais verdadeiros e se beneficiam da escalabilidade vetorial

### Alternativa 3: Nao Otimizar e Aceitar Tamanho Atual
- **Descricao:** Manter SVGs como estao sem otimizacao
- **Motivo da rejeicao:** Mesmo uma reducao de 1% e valiosa; estabelecer pipeline de otimizacao e importante para o futuro

## Referencias
- SVGO: https://github.com/svg/svgo
- TASK-0011: `/docs/backlog/TASK-0011.md`
- Quick Win MPF-005: `/docs/planning/PRD-0002_validated.md`
