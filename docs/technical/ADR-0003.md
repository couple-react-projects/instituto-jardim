# ADR-0003: Atualizacao de Vite 5.0.8 para 7.3.1

## Vinculado a
TASK-0010

## Status
Accepted

## Contexto

O projeto estava utilizando Vite 5.0.8 e @vitejs/plugin-react 4.2.1, que apresentavam 2 vulnerabilidades de seguranca moderadas:

1. **esbuild <= 0.24.2**: GHSA-67mh-4wv8-2f99 (Severity: Moderate, CVSS 5.3)
   - Vulnerabilidade que permite que qualquer website envie requisicoes para o servidor de desenvolvimento e leia as respostas
2. **vite 0.11.0 - 6.1.6**: Dependente do esbuild vulneravel

A atualizacao de dependencias com vulnerabilidades e uma pratica essencial de seguranca, especialmente para ambientes de desenvolvimento que podem estar expostos a redes corporativas ou compartilhadas.

## Decisao

Atualizar as seguintes dependencias:

- **vite**: 5.0.8 → 7.3.1 (major version bump)
- **@vitejs/plugin-react**: 4.2.1 → 5.1.3 (major version bump)

Adicionalmente, ajustar a configuracao do servidor no `vite.config.ts`:
- **server.host**: de IP fixo `192.168.1.8` para `true` (permite acesso em rede local sem IP fixo)
- **server.strictPort**: de `true` para `false` (permite fallback se porta estiver ocupada)

## Consequencias

### Positivas

1. **Seguranca**: Eliminadas 2 vulnerabilidades moderadas (npm audit = 0 vulnerabilities)
2. **Desempenho**: Vite 7 traz melhorias de performance no build e HMR
3. **Compatibilidade**: Versoes atualizadas tem melhor suporte a features modernas do JavaScript/TypeScript
4. **Portabilidade**: Configuracao de host flexivel permite executar projeto em diferentes ambientes de rede
5. **Facilidade de desenvolvimento**: strictPort: false evita erros ao trocar de porta ocupada
6. **Manutencao**: Dependencias atualizadas reduzem debito tecnico
7. **Transicao suave**: Nenhum breaking change significativo detectado - build, lint e aplicacao funcionando corretamente

### Negativas

1. **Risco de breaking changes**: Major version bump pode introduzir mudancas incompativeis (mitigado por testes completos)
2. **Aprendizado**: Equipe pode precisar se familiarizar com novas APIs ou comportamentos do Vite 7
3. **Dependencias futuras**: Outras bibliotecas podem ter requisitos especificos de versao do Vite (nao aplicavel no momento)

## Alternativas Consideradas

### Alternativa 1: Atualizar apenas para Vite 6.x

- **Descricao**: Atualizar para versao intermediaria Vite 6.x para reduzir risco de breaking changes
- **Motivo da rejeicao**: 
  - Vite 6.x ainda contem vulnerabilidade (range afetado: 0.11.0 - 6.1.6)
  - Seria necessario atualizar para 7.x de qualquer forma para eliminar vulnerabilidades
  - Atualizacao incremental adiciona trabalho sem beneficio (2 major bumps em vez de 1)

### Alternativa 2: Usar npm audit fix --force automaticamente

- **Descricao**: Executar comando automatico de correcao sem analise previa
- **Motivo da rejeicao**:
  - Pode introduzir breaking changes sem planejamento
  - Nao permite backup ou estrategia de rollback
  - Nao documenta decisoes arquiteturais tomadas
  - Abordagem manual permitiu ajuste preventivo na configuracao do servidor

### Alternativa 3: Manter versoes antigas e desabilitar avisos de seguranca

- **Descricao**: Ignorar vulnerabilidades e continuar com versoes antigas
- **Motivo da rejeicao**:
  - Viola principios basicos de seguranca
  - Aumenta superficie de ataque em ambientes de desenvolvimento compartilhados
  - Cria debito tecnico que se acumula ao longo do tempo
  - CVSS 5.3 e severidade moderada, mas pode ser explorada em cenarios especificos

## Validacao Realizada

Todos os criterios de aceitacao da TASK-0010 foram atendidos:

- ✅ `npm audit` retorna "found 0 vulnerabilities"
- ✅ `npm run build` executa sem erros (build em 549ms)
- ✅ `npm run lint` passa sem erros
- ✅ Servidor dev funciona corretamente (vite v7.3.1 ready in 173ms)
- ✅ Servidor preview funciona corretamente
- ✅ Nenhum warning de deprecacao no output do build
- ✅ Path alias `@/` continua funcionando
- ✅ CSS Modules nao foram afetados (verificado via build)
- ✅ TypeScript strict mode sem erros (tsc passou no build)

## Configuracoes Ajustadas

### vite.config.ts

```typescript
// ANTES
server:{
  host: '192.168.1.8',
  strictPort: true,
}

// DEPOIS
server:{
  host: true,
  strictPort: false,
}
```

**Justificativa**: 
- `host: true` permite acesso via rede local sem exigir IP fixo
- `strictPort: false` permite fallback se porta estiver ocupada
- Melhora portabilidade entre diferentes ambientes de desenvolvimento

## Referências

- [Vite 7 Release Notes](https://vitejs.dev/guide/migration)
- [GHSA-67mh-4wv8-2f99](https://github.com/advisories/GHSA-67mh-4wv8-2f99)
- TASK-0010: Atualizar dependencias vulneraveis
- PRD-0002: Quick Wins Top 10
